# ============================================================
# DB-Doctor 监控与通知功能配置示例
# ============================================================
# 将此配置复制到 application-local.yml 中，并根据实际情况修改

db-doctor:
  # 监控配置
  monitoring:
    # 健康检查
    health-check:
      enabled: true
      interval-seconds: 60  # 健康检查间隔（秒）

    # 指标采集
    metrics-collection:
      slow-query:
        enabled: true
        interval-seconds: 30  # 慢查询指标采集间隔（秒）
      ai-analysis:
        enabled: true
        interval-seconds: 60  # AI 分析指标采集间隔（秒）

    # 告警配置
    alert:
      rules:
        # 慢查询处理速率告警
        slow-query-qps:
          enabled: true
          threshold: 10.0  # 每秒超过10个慢查询
          severity: WARNING

        # AI 分析耗时告警
        ai-analysis-duration:
          enabled: true
          threshold: 30.0  # 平均耗时超过30秒
          severity: CRITICAL

        # 队列积压告警
        queue-backlog:
          enabled: true
          threshold: 100.0  # 队列积压超过100
          severity: WARNING

        # 数据源连接失败告警
        datasource-failure:
          enabled: true
          threshold: 1.0  # 连接失败
          severity: CRITICAL

      cool-down:
        default-minutes: 30  # 默认冷却期（分钟）
        rule-cool-down-minutes:
          slow-query-qps: 15
          ai-analysis-duration: 60

  # 通知配置
  notification:
    # 邮件通知
    mail:
      enabled: false  # 是否启用邮件通知
      host: smtp.example.com
      port: 587
      username: your-email@example.com
      password: your-password
      from: DB-Doctor <noreply@dbdoctor.com>
      # 根据严重程度配置收件人
      to:
        CRITICAL: admin@example.com,ops@example.com
        WARNING: ops@example.com
        INFO: dev@example.com
      subject-prefix: "[DB-Doctor告警]"

    # Webhook 通知
    webhook:
      # 钉钉通知
      dingtalk:
        enabled: false  # 是否启用钉钉通知
        webhook: https://oapi.dingtalk.com/robot/send?access_token=xxx
        secret: SECxxxxxxxxxxxx  # 可选，如果机器人设置了加签

      # 飞书通知
      feishu:
        enabled: false  # 是否启用飞书通知
        webhook: https://open.feishu.cn/open-apis/bot/v2/hook/xxx

      # 企业微信通知
      wecom:
        enabled: false  # 是否启用企业微信通知
        webhook: https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxx

# ============================================================
# 使用说明
# ============================================================
#
# 1. 邮件通知配置：
#    - 配置 SMTP 服务器信息（host、port、username、password）
#    - 配置发件人信息（from）
#    - 配置不同严重程度的收件人（to.CRITICAL/WARNING/INFO）
#
# 2. 钉钉机器人配置：
#    - 在钉钉群中添加自定义机器人
#    - 获取 Webhook URL
#    - 可选：配置安全设置（加签或关键词）
#    - 将 webhook URL 配置到 db-doctor.notification.webhook.dingtalk.webhook
#    - 如果启用了加签，配置 secret
#
# 3. 飞书机器人配置：
#    - 在飞书群中添加自定义机器人
#    - 获取 Webhook URL
#    - 将 URL 配置到 db-doctor.notification.webhook.feishu.webhook
#
# 4. 企业微信机器人配置：
#    - 在企业微信群中添加自定义机器人
#    - 获取 Webhook URL（包含 key 参数）
#    - 将 URL 配置到 db-doctor.notification.webhook.wecom.webhook
#
# 5. 测试通知：
#    - 启动应用后，调用 POST /api/notification/test
#    - 请求体：{"channel": "DINGTALK"}  （或 EMAIL、FEISHU、WECOM）
#
# ============================================================
