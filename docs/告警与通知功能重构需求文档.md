# å‘Šè­¦ä¸é€šçŸ¥åŠŸèƒ½é‡æ„éœ€æ±‚æ–‡æ¡£

**ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2026-02-07
**é¡¹ç›®**: DB-Doctor v3.2.0
**è´Ÿè´£äºº**: å¼€å‘å›¢é˜Ÿ

---

## ğŸ“‹ ç›®å½•

1. [éœ€æ±‚æ¦‚è¿°](#ä¸€éœ€æ±‚æ¦‚è¿°)
2. [åŠŸèƒ½è¯¦ç»†è¯´æ˜](#äºŒåŠŸèƒ½è¯¦ç»†è¯´æ˜)
3. [ç•Œé¢åŸå‹è®¾è®¡](#ä¸‰ç•Œé¢åŸå‹è®¾è®¡)
4. [APIæ¥å£è®¾è®¡](#å››apiæ¥å£è®¾è®¡)
5. [æ•°æ®åº“è®¾è®¡](#äº”æ•°æ®åº“è®¾è®¡)
6. [åç«¯å®ç°æ–¹æ¡ˆ](#å…­åç«¯å®ç°æ–¹æ¡ˆ)
7. [å‰ç«¯å®ç°æ–¹æ¡ˆ](#ä¸ƒå‰ç«¯å®ç°æ–¹æ¡ˆ)
8. [å¼€å‘ä»»åŠ¡æ¸…å•](#å…«å¼€å‘ä»»åŠ¡æ¸…å•)
9. [æµ‹è¯•éªŒæ”¶æ ‡å‡†](#ä¹æµ‹è¯•éªŒæ”¶æ ‡å‡†)

---

## ä¸€ã€éœ€æ±‚æ¦‚è¿°

### 1.1 èƒŒæ™¯

å½“å‰ DB-Doctor é¡¹ç›®çš„å‘Šè­¦ä¸é€šçŸ¥åŠŸèƒ½å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
- âŒ æ–°å¢äº†å¯è‡ªå®šä¹‰çš„å‘Šè­¦è§„åˆ™åŠŸèƒ½ï¼Œä½†å®é™…ç³»ç»Ÿä½¿ç”¨çš„æ˜¯ç¡¬ç¼–ç çš„è§¦å‘é€»è¾‘
- âŒ é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„å‘Šè­¦è§„åˆ™ï¼ˆæ…¢æŸ¥è¯¢ QPSã€AI åˆ†æè€—æ—¶ç­‰ï¼‰æœªè¢«åç«¯ä»£ç ä½¿ç”¨
- âŒ å‰ç«¯é¡µé¢åŠŸèƒ½ä¸åç«¯å®é™…é€»è¾‘ä¸åŒ¹é…

### 1.2 ç›®æ ‡

**é‡æ„ç›®æ ‡**ï¼šç®€åŒ–å‘Šè­¦åŠŸèƒ½ï¼Œåªä¿ç•™ç³»ç»Ÿå†…ç½®çš„è§¦å‘é€»è¾‘ï¼Œå…è®¸ç”¨æˆ·è°ƒæ•´å‚æ•°ï¼Œä½†ä¸å…è®¸è‡ªå®šä¹‰è§„åˆ™ã€‚

### 1.3 æ¶‰åŠçš„é…ç½®å‚æ•°

```yaml
db-doctor:
  notify:
    severity-threshold: 3.0          # ä¸¥é‡ç¨‹åº¦é˜ˆå€¼ï¼ˆç§’ï¼‰
    cool-down-hours: 1                # å†·å´æœŸï¼ˆå°æ—¶ï¼‰
    degradation-multiplier: 1.5       # æ€§èƒ½æ¶åŒ–å€ç‡
```

**è¯´æ˜**ï¼š
- è¿™3ä¸ªå‚æ•°å·²ç»åœ¨ `AnalysisService.shouldNotify()` ä¸­ä½¿ç”¨
- å½“å‰ç¡¬ç¼–ç åœ¨ `application.yml` ä¸­ï¼Œä¸æ”¯æŒçƒ­æ›´æ–°
- **ç›®æ ‡**ï¼šæ”¹ä¸ºå¯ä»å‰ç«¯é…ç½®ï¼Œæ”¯æŒçƒ­æ›´æ–°

---

## äºŒã€åŠŸèƒ½è¯¦ç»†è¯´æ˜

### 2.1 é¡µé¢ç»“æ„è°ƒæ•´

#### 2.1.1 å¯¼èˆªæ è°ƒæ•´

| ä¿®æ”¹å‰ | ä¿®æ”¹å | è¯´æ˜ |
|--------|--------|------|
| ç›‘æ§ä¸­å¿ƒ | å‘Šè­¦ä¸é€šçŸ¥ | è·¯ç”±è·¯å¾„ `/monitoring` æ”¹ä¸º `/alert-notify` |
| - | é€šçŸ¥è®¾ç½® | æ–°å¢ç‹¬ç«‹é¡µé¢ï¼Œè·¯å¾„ `/alert-notify/notification` |
| - | å‘Šè­¦å†å² | æ–°å¢ç‹¬ç«‹é¡µé¢ï¼Œè·¯å¾„ `/alert-notify/history` |

#### 2.1.2 è®¾ç½®ä¸­å¿ƒè°ƒæ•´

| ä¿®æ”¹å‰ | ä¿®æ”¹å | è¯´æ˜ |
|--------|--------|------|
| ç›‘æ§ä¸é€šçŸ¥ â†’ å‘Šè­¦è§„åˆ™ | å‘Šè­¦ä¸é€šçŸ¥ â†’ å‘Šè­¦è®¾ç½® | åªä¿ç•™å‚æ•°é…ç½®ï¼Œç§»é™¤è§„åˆ™è¡¨æ ¼ |
| ç›‘æ§ä¸é€šçŸ¥ â†’ é€šçŸ¥æ–¹å¼ | å‘Šè­¦ä¸é€šçŸ¥ â†’ é€šçŸ¥è®¾ç½® | ä¿æŒä¸å˜ |

### 2.2 å‘Šè­¦è®¾ç½®é¡µé¢

#### 2.2.1 åŠŸèƒ½æè¿°

åœ¨è®¾ç½®ä¸­å¿ƒæä¾›3ä¸ªæ ¸å¿ƒå‚æ•°çš„é…ç½®ç•Œé¢ï¼š
- **ä¸¥é‡ç¨‹åº¦é˜ˆå€¼**ï¼šè§¦å‘å‘Šè­¦çš„æœ€ä½æŸ¥è¯¢è€—æ—¶
- **å†·å´æœŸ**ï¼šåŒä¸€ SQL ä¸¤æ¬¡é€šçŸ¥çš„æœ€å°é—´éš”æ—¶é—´
- **æ€§èƒ½æ¶åŒ–å€ç‡**ï¼šè§¦å‘äºŒæ¬¡å”¤é†’é€šçŸ¥çš„æ€§èƒ½æ¶åŒ–æ¯”ä¾‹

#### 2.2.2 å‚æ•°è¯´æ˜

| å‚æ•°åç§° | ç±»å‹ | é»˜è®¤å€¼ | å–å€¼èŒƒå›´ | è¯´æ˜ |
|---------|------|--------|---------|------|
| `severity-threshold` | Double | 3.0 | 1.0-10.0 | å¹³å‡æŸ¥è¯¢è€—æ—¶ä½äºæ­¤å€¼ä¸å‘é€é€šçŸ¥ |
| `cool-down-hours` | Integer | 1 | 1-168 | è·ä¸Šæ¬¡é€šçŸ¥ä¸è¶³æ­¤æ—¶é•¿ä¸å‘é€é€šçŸ¥ï¼ˆ1å°æ—¶-1å‘¨ï¼‰ |
| `degradation-multiplier` | Double | 1.5 | 1.1-10.0 | å½“å‰è€—æ—¶/ä¸Šæ¬¡é€šçŸ¥è€—æ—¶ >= æ­¤å€¼æ—¶è§¦å‘äºŒæ¬¡å”¤é†’ |

#### 2.2.3 ç•Œé¢è®¾è®¡è¦æ±‚

- âœ… æ¯ä¸ªé…ç½®é¡¹å³ä¾§æ·»åŠ  `?` å›¾æ ‡ï¼Œé¼ æ ‡æ‚¬åœæ˜¾ç¤ºè¯¦ç»†è¯´æ˜
- âœ… é…ç½®é¡¹ä¸‹æ–¹æ˜¾ç¤ºå½“å‰å–å€¼èŒƒå›´æç¤º
- âœ… ä¿®æ”¹åç«‹å³ä¿å­˜åˆ°æ•°æ®åº“ï¼Œæ— éœ€ç‚¹å‡»"ä¿å­˜"æŒ‰é’®
- âœ… ä¿å­˜æˆåŠŸåæ˜¾ç¤º Toast æç¤º
- âŒ ä¸æä¾›å¯ç”¨/ç¦ç”¨å¼€å…³ï¼ˆè¿™3ä¸ªå‚æ•°æ˜¯å¿…é¡»é…ç½®çš„ï¼‰

### 2.3 å‘Šè­¦å†å²é¡µé¢ï¼ˆæ–°å¢ï¼‰

#### 2.3.1 åŠŸèƒ½æè¿°

æ–°å¢ç‹¬ç«‹çš„å¯¼èˆªæ é¡µé¢ï¼Œå±•ç¤ºæ‰€æœ‰å‘Šè­¦å†å²è®°å½•ã€‚

#### 2.3.2 é¡µé¢å†…å®¹

- **ç»Ÿè®¡å¡ç‰‡**ï¼šæ€»å‘Šè­¦æ•°ã€ä¸¥é‡å‘Šè­¦æ•°ã€è­¦å‘Šå‘Šè­¦æ•°ã€å·²è§£å†³æ•°
- **ç­›é€‰å™¨**ï¼šä¸¥é‡ç¨‹åº¦ã€çŠ¶æ€ã€æ—¶é—´èŒƒå›´
- **å‘Šè­¦åˆ—è¡¨**ï¼šè¡¨æ ¼å±•ç¤ºï¼Œæ”¯æŒåˆ†é¡µ
- **æ“ä½œæŒ‰é’®**ï¼šæ ‡è®°è§£å†³ã€æŸ¥çœ‹è¯¦æƒ…

#### 2.3.3 æ•°æ®æ¥æº

ä» `alert_history` è¡¨è¯»å–æ•°æ®ï¼Œè¯¥è¡¨ç”± `AlertRuleEngine` åœ¨è§¦å‘å‘Šè­¦æ—¶å†™å…¥ã€‚

### 2.4 é€šçŸ¥è®¾ç½®é¡µé¢ï¼ˆä¿æŒï¼‰

#### 2.4.1 åŠŸèƒ½æè¿°

é…ç½®å„ç§é€šçŸ¥æ¸ é“ï¼ˆé‚®ä»¶ã€é’‰é’‰ã€ä¼ä¸šå¾®ä¿¡ã€é£ä¹¦ï¼‰çš„å‚æ•°ã€‚

#### 2.4.2 å®ç°æ–¹å¼

**ä¿æŒç°æœ‰å®ç°ä¸å˜**ï¼š
- ä½¿ç”¨ `NotificationConfigController` æä¾›çš„ API
- å‰ç«¯é¡µé¢ä½¿ç”¨ `NotificationConfig.vue`
- é…ç½®å­˜å‚¨åœ¨ `notification_config` è¡¨ä¸­

---

## ä¸‰ã€ç•Œé¢åŸå‹è®¾è®¡

### 3.1 å‘Šè­¦è®¾ç½®é¡µé¢ï¼ˆè®¾ç½®ä¸­å¿ƒï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¾ç½®ä¸­å¿ƒ                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [åŸºç¡€é…ç½®] [å‘Šè­¦ä¸é€šçŸ¥]                                      â”‚
â”‚                                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ å‘Šè­¦è®¾ç½®                                                â”‚   â”‚
â”‚ â”‚                                                        â”‚   â”‚
â”‚ â”‚ ä¸¥é‡ç¨‹åº¦é˜ˆå€¼ï¼ˆç§’ï¼‰                              [?]  â”‚   â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  èŒƒå›´: 1.0 - 10.0                   â”‚   â”‚
â”‚ â”‚ â”‚     3.0       â”‚  âš ï¸ å¹³å‡æŸ¥è¯¢è€—æ—¶ä½äºæ­¤å€¼ä¸å‘é€é€šçŸ¥      â”‚   â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚   â”‚
â”‚ â”‚                                                        â”‚   â”‚
â”‚ â”‚ å†·å´æœŸï¼ˆå°æ—¶ï¼‰                                [?]  â”‚   â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  èŒƒå›´: 1 - 168                      â”‚   â”‚
â”‚ â”‚ â”‚      1        â”‚  â„¹ï¸ åŒä¸€ SQL ä¸¤æ¬¡é€šçŸ¥çš„æœ€å°é—´éš”æ—¶é—´    â”‚   â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚   â”‚
â”‚ â”‚                                                        â”‚   â”‚
â”‚ â”‚ æ€§èƒ½æ¶åŒ–å€ç‡                                  [?]  â”‚   â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  èŒƒå›´: 1.1 - 10.0                   â”‚   â”‚
â”‚ â”‚ â”‚     1.5       â”‚  âš¡ è§¦å‘äºŒæ¬¡å”¤é†’é€šçŸ¥çš„æ€§èƒ½æ¶åŒ–æ¯”ä¾‹      â”‚   â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  å½“å‰è€—æ—¶/ä¸Šæ¬¡é€šçŸ¥è€—æ—¶ >= æ­¤å€¼æ—¶è§¦å‘    â”‚   â”‚
â”‚ â”‚                                                        â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å‘Šè­¦å†å²é¡µé¢ï¼ˆç‹¬ç«‹å¯¼èˆªé¡µï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‘Šè­¦ä¸é€šçŸ¥ > å‘Šè­¦å†å²                    [åˆ·æ–°æŒ‰é’®]            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç»Ÿè®¡å¡ç‰‡ï¼š                                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚ â”‚æ€»å‘Šè­¦æ•° â”‚ â”‚ä¸¥é‡å‘Šè­¦ â”‚ â”‚è­¦å‘Šå‘Šè­¦ â”‚ â”‚ å·²è§£å†³  â”‚            â”‚
â”‚ â”‚  123    â”‚ â”‚  15     â”‚ â”‚  58     â”‚ â”‚  50     â”‚            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                              â”‚
â”‚ ç­›é€‰å™¨ï¼š                                                     â”‚
â”‚ ä¸¥é‡ç¨‹åº¦: [å…¨éƒ¨â–¼]  çŠ¶æ€: [å…¨éƒ¨â–¼]  [æŸ¥è¯¢] [é‡ç½®]             â”‚
â”‚                                                              â”‚
â”‚ å‘Šè­¦åˆ—è¡¨ï¼š                                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚å‘Šè­¦è§„åˆ™    â”‚ç¨‹åº¦  â”‚çŠ¶æ€  â”‚å‘Šè­¦å†…å®¹    â”‚è§¦å‘æ—¶é—´    â”‚æ“ä½œâ”‚â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤â”‚
â”‚ â”‚æ…¢æŸ¥è¯¢å‘Šè­¦   â”‚ä¸¥é‡  â”‚è§¦å‘ä¸­â”‚SQL è€—æ—¶...â”‚2026-02-07 â”‚è§£å†³â”‚â”‚
â”‚ â”‚AI åˆ†æå‘Šè­¦  â”‚è­¦å‘Š  â”‚å·²è§£å†³â”‚åˆ†æè¶…æ—¶...â”‚2026-02-07 â”‚è¯¦æƒ…â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â”‚ åˆ†é¡µ: << 1 2 3 4 5 >>                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 å¯¼èˆªæ ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Logo] DB-Doctor                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ  ä»ªè¡¨ç›˜                                   â”‚
â”‚ ğŸ“Š æ…¢æŸ¥è¯¢æŠ¥è¡¨                               â”‚
â”‚ ğŸ¤– AI ç›‘æ§                                  â”‚
â”‚ ğŸ”” å‘Šè­¦ä¸é€šçŸ¥ â–¼                             â”‚
â”‚     â”œâ”€â”€ ğŸ“‹ å‘Šè­¦å†å²                         â”‚
â”‚     â””â”€â”€ âš™ï¸ é€šçŸ¥è®¾ç½®                         â”‚
â”‚ âš™ï¸ è®¾ç½®ä¸­å¿ƒ                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å››ã€APIæ¥å£è®¾è®¡

### 4.1 å‘Šè­¦è®¾ç½® APIï¼ˆæ–°å¢ï¼‰

#### 4.1.1 æŸ¥è¯¢å‘Šè­¦è®¾ç½®

```http
GET /api/alert-settings
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": "SUCCESS",
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "severityThreshold": 3.0,
    "coolDownHours": 1,
    "degradationMultiplier": 1.5
  }
}
```

#### 4.1.2 æ›´æ–°å‘Šè­¦è®¾ç½®

```http
POST /api/alert-settings
Content-Type: application/json

{
  "severityThreshold": 5.0,
  "coolDownHours": 2,
  "degradationMultiplier": 2.0
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": "SUCCESS",
  "message": "ä¿å­˜æˆåŠŸ"
}
```

#### 4.1.3 é‡ç½®ä¸ºé»˜è®¤å€¼

```http
POST /api/alert-settings/reset
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": "SUCCESS",
  "message": "å·²é‡ç½®ä¸ºé»˜è®¤å€¼",
  "data": {
    "severityThreshold": 3.0,
    "coolDownHours": 1,
    "degradationMultiplier": 1.5
  }
}
```

### 4.2 å‘Šè­¦å†å² APIï¼ˆå·²å­˜åœ¨ï¼‰

#### 4.2.1 æŸ¥è¯¢å‘Šè­¦åˆ—è¡¨

```http
GET /api/alerts?page=0&size=20&severity=CRITICAL&status=FIRING
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": "SUCCESS",
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "total": 123,
    "page": 0,
    "size": 20,
    "list": [
      {
        "id": 1,
        "ruleName": "æ…¢æŸ¥è¯¢å‘Šè­¦",
        "severity": "CRITICAL",
        "status": "FIRING",
        "message": "å‘Šè­¦è§„åˆ™ [æ…¢æŸ¥è¯¢å‘Šè­¦] è¢«è§¦å‘...",
        "triggeredAt": "2026-02-07T10:30:00",
        "metrics": "{\"slowQueryQps\": 15.5}"
      }
    ]
  }
}
```

#### 4.2.2 æ ‡è®°å‘Šè­¦å·²è§£å†³

```http
POST /api/alerts/{id}/resolve
Content-Type: application/json

{
  "resolvedBy": "admin"
}
```

#### 4.2.3 è·å–å‘Šè­¦ç»Ÿè®¡

```http
GET /api/alerts/stats
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": "SUCCESS",
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "total": 123,
    "severity_CRITICAL": 15,
    "severity_WARNING": 58,
    "severity_INFO": 50,
    "RESOLVED": 50,
    "FIRING": 73
  }
}
```

---

## äº”ã€æ•°æ®åº“è®¾è®¡

### 5.1 è¡¨ç»“æ„è°ƒæ•´

#### 5.1.1 åˆ é™¤ `alert_rule` è¡¨

```sql
-- è¯¥è¡¨ä¸å†ä½¿ç”¨ï¼Œå¯ä»¥ä¿ç•™ï¼ˆä½†ä¸ä½¿ç”¨ï¼‰
-- DROP TABLE IF EXISTS alert_rule;
```

#### 5.1.2 ä¿ç•™ `alert_history` è¡¨

```sql
-- å‘Šè­¦å†å²è¡¨ï¼ˆå·²å­˜åœ¨ï¼Œä¿æŒä¸å˜ï¼‰
CREATE TABLE alert_history (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  rule_id BIGINT,
  rule_name VARCHAR(100),
  severity VARCHAR(20),
  status VARCHAR(20),
  message TEXT,
  metrics TEXT,
  triggered_at DATETIME,
  resolved_at DATETIME,
  resolved_by VARCHAR(50),
  INDEX idx_severity (severity),
  INDEX idx_status (status),
  INDEX idx_triggered_at (triggered_at)
);
```

#### 5.1.3 ä¿ç•™ `notification_config` è¡¨

```sql
-- é€šçŸ¥é…ç½®è¡¨ï¼ˆå·²å­˜åœ¨ï¼Œä¿æŒä¸å˜ï¼‰
CREATE TABLE notification_config (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  channel VARCHAR(50) UNIQUE,
  enabled BOOLEAN,
  config TEXT,
  severity_levels VARCHAR(200),
  created_at DATETIME,
  updated_at DATETIME
);
```

### 5.2 é…ç½®å­˜å‚¨æ–¹å¼

**æ–¹æ¡ˆ**ï¼šä½¿ç”¨ `system_config` è¡¨å­˜å‚¨å‘Šè­¦è®¾ç½®

| config_key | config_value | config_group | description |
|------------|-------------|--------------|-------------|
| `alert.severity-threshold` | `3.0` | `alert` | ä¸¥é‡ç¨‹åº¦é˜ˆå€¼ï¼ˆç§’ï¼‰ |
| `alert.cool-down-hours` | `1` | `alert` | å†·å´æœŸï¼ˆå°æ—¶ï¼‰ |
| `alert.degradation-multiplier` | `1.5` | `alert` | æ€§èƒ½æ¶åŒ–å€ç‡ |

**ä¼˜åŠ¿**ï¼š
- âœ… å¤ç”¨ç°æœ‰çš„é…ç½®çƒ­æ›´æ–°æœºåˆ¶
- âœ… ä¸éœ€è¦æ–°å¢è¡¨ç»“æ„
- âœ… æ”¯æŒå®¡è®¡ï¼ˆupdated_atã€updated_byï¼‰

---

## å…­ã€åç«¯å®ç°æ–¹æ¡ˆ

### 6.1 åˆ›å»ºé…ç½®ç±»

#### 6.1.1 AlertSettingsDTO.java

```java
package com.dbdoctor.dto;

import lombok.Data;

/**
 * å‘Šè­¦è®¾ç½® DTO
 */
@Data
public class AlertSettingsDTO {
    /**
     * ä¸¥é‡ç¨‹åº¦é˜ˆå€¼ï¼ˆç§’ï¼‰
     * å–å€¼èŒƒå›´: 1.0-10.0
     */
    @DecimalMin(value = "1.0", message = "ä¸¥é‡ç¨‹åº¦é˜ˆå€¼ä¸èƒ½å°äº 1.0")
    @DecimalMax(value = "10.0", message = "ä¸¥é‡ç¨‹åº¦é˜ˆå€¼ä¸èƒ½å¤§äº 10.0")
    private Double severityThreshold;

    /**
     * å†·å´æœŸï¼ˆå°æ—¶ï¼‰
     * å–å€¼èŒƒå›´: 1-168
     */
    @Min(value = 1, message = "å†·å´æœŸä¸èƒ½å°äº 1 å°æ—¶")
    @Max(value = 168, message = "å†·å´æœŸä¸èƒ½å¤§äº 168 å°æ—¶ï¼ˆ1å‘¨ï¼‰")
    private Integer coolDownHours;

    /**
     * æ€§èƒ½æ¶åŒ–å€ç‡
     * å–å€¼èŒƒå›´: 1.1-10.0
     */
    @DecimalMin(value = "1.1", message = "æ€§èƒ½æ¶åŒ–å€ç‡ä¸èƒ½å°äº 1.1")
    @DecimalMax(value = "10.0", message = "æ€§èƒ½æ¶åŒ–å€ç‡ä¸èƒ½å¤§äº 10.0")
    private Double degradationMultiplier;
}
```

### 6.2 åˆ›å»º Controller

#### 6.2.1 AlertSettingsController.java

```java
package com.dbdoctor.controller;

import com.dbdoctor.dto.AlertSettingsDTO;
import com.dbdoctor.service.AlertSettingsService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.*;

import java.util.Map;

/**
 * å‘Šè­¦è®¾ç½® API æ§åˆ¶å™¨
 */
@Slf4j
@RestController
@RequestMapping("/api/alert-settings")
@RequiredArgsConstructor
public class AlertSettingsController {

    private final AlertSettingsService alertSettingsService;

    /**
     * æŸ¥è¯¢å‘Šè­¦è®¾ç½®
     */
    @GetMapping
    public Map<String, Object> getAlertSettings() {
        log.info("[å‘Šè­¦è®¾ç½®API] æŸ¥è¯¢å‘Šè­¦è®¾ç½®");
        try {
            AlertSettingsDTO settings = alertSettingsService.getAlertSettings();
            return Map.of(
                    "code", "SUCCESS",
                    "message", "æŸ¥è¯¢æˆåŠŸ",
                    "data", settings
            );
        } catch (Exception e) {
            log.error("[å‘Šè­¦è®¾ç½®API] æŸ¥è¯¢å¤±è´¥", e);
            return Map.of(
                    "code", "ERROR",
                    "message", "æŸ¥è¯¢å¤±è´¥: " + e.getMessage()
            );
        }
    }

    /**
     * æ›´æ–°å‘Šè­¦è®¾ç½®
     */
    @PostMapping
    public Map<String, Object> updateAlertSettings(@RequestBody AlertSettingsDTO settings) {
        log.info("[å‘Šè­¦è®¾ç½®API] æ›´æ–°å‘Šè­¦è®¾ç½®: {}", settings);
        try {
            alertSettingsService.updateAlertSettings(settings);
            return Map.of(
                    "code", "SUCCESS",
                    "message", "ä¿å­˜æˆåŠŸ"
            );
        } catch (IllegalArgumentException e) {
            log.warn("[å‘Šè­¦è®¾ç½®API] å‚æ•°æ ¡éªŒå¤±è´¥: {}", e.getMessage());
            return Map.of(
                    "code", "INVALID_PARAMS",
                    "message", e.getMessage()
            );
        } catch (Exception e) {
            log.error("[å‘Šè­¦è®¾ç½®API] æ›´æ–°å¤±è´¥", e);
            return Map.of(
                    "code", "ERROR",
                    "message", "ä¿å­˜å¤±è´¥: " + e.getMessage()
            );
        }
    }

    /**
     * é‡ç½®ä¸ºé»˜è®¤å€¼
     */
    @PostMapping("/reset")
    public Map<String, Object> resetAlertSettings() {
        log.info("[å‘Šè­¦è®¾ç½®API] é‡ç½®å‘Šè­¦è®¾ç½®");
        try {
            AlertSettingsDTO settings = alertSettingsService.resetAlertSettings();
            return Map.of(
                    "code", "SUCCESS",
                    "message", "å·²é‡ç½®ä¸ºé»˜è®¤å€¼",
                    "data", settings
            );
        } catch (Exception e) {
            log.error("[å‘Šè­¦è®¾ç½®API] é‡ç½®å¤±è´¥", e);
            return Map.of(
                    "code", "ERROR",
                    "message", "é‡ç½®å¤±è´¥: " + e.getMessage()
            );
        }
    }
}
```

### 6.3 åˆ›å»º Service

#### 6.3.1 AlertSettingsService.java

```java
package com.dbdoctor.service;

import com.dbdoctor.config.DbDoctorProperties;
import com.dbdoctor.dto.AlertSettingsDTO;
import com.dbdoctor.entity.SystemConfig;
import com.dbdoctor.repository.SystemConfigRepository;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.cache.CacheManager;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.time.LocalDateTime;

/**
 * å‘Šè­¦è®¾ç½®æœåŠ¡
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class AlertSettingsService {

    private final SystemConfigRepository configRepository;
    private final DbDoctorProperties properties;
    private final CacheManager cacheManager;

    /**
     * æŸ¥è¯¢å‘Šè­¦è®¾ç½®
     */
    public AlertSettingsDTO getAlertSettings() {
        log.info("[å‘Šè­¦è®¾ç½®æœåŠ¡] æŸ¥è¯¢å‘Šè­¦è®¾ç½®");

        // ä»æ•°æ®åº“è¯»å–é…ç½®
        Double severityThreshold = getDoubleConfig("alert.severity-threshold", 3.0);
        Integer coolDownHours = getIntConfig("alert.cool-down-hours", 1);
        Double degradationMultiplier = getDoubleConfig("alert.degradation-multiplier", 1.5);

        return AlertSettingsDTO.builder()
                .severityThreshold(severityThreshold)
                .coolDownHours(coolDownHours)
                .degradationMultiplier(degradationMultiplier)
                .build();
    }

    /**
     * æ›´æ–°å‘Šè­¦è®¾ç½®
     */
    @Transactional
    public void updateAlertSettings(AlertSettingsDTO settings) {
        log.info("[å‘Šè­¦è®¾ç½®æœåŠ¡] æ›´æ–°å‘Šè­¦è®¾ç½®: {}", settings);

        // ä¿å­˜åˆ°æ•°æ®åº“
        saveConfig("alert.severity-threshold", settings.getSeverityThreshold().toString());
        saveConfig("alert.cool-down-hours", settings.getCoolDownHours().toString());
        saveConfig("alert.degradation-multiplier", settings.getDegradationMultiplier().toString());

        // æ¸…é™¤ç¼“å­˜ï¼Œè®© Spring é‡æ–°è¯»å–
        clearConfigCache();

        log.info("[å‘Šè­¦è®¾ç½®æœåŠ¡] å‘Šè­¦è®¾ç½®å·²æ›´æ–°å¹¶ç”Ÿæ•ˆï¼ˆçƒ­æ›´æ–°ï¼‰");
    }

    /**
     * é‡ç½®ä¸ºé»˜è®¤å€¼
     */
    @Transactional
    public AlertSettingsDTO resetAlertSettings() {
        log.info("[å‘Šè­¦è®¾ç½®æœåŠ¡] é‡ç½®å‘Šè­¦è®¾ç½®ä¸ºé»˜è®¤å€¼");

        AlertSettingsDTO defaultSettings = AlertSettingsDTO.builder()
                .severityThreshold(3.0)
                .coolDownHours(1)
                .degradationMultiplier(1.5)
                .build();

        updateAlertSettings(defaultSettings);
        return defaultSettings;
    }

    /**
     * è·å– Double ç±»å‹é…ç½®
     */
    private Double getDoubleConfig(String key, double defaultValue) {
        return configRepository.findByConfigKey(key)
                .map(config -> Double.parseDouble(config.getConfigValue()))
                .orElse(defaultValue);
    }

    /**
     * è·å– Integer ç±»å‹é…ç½®
     */
    private Integer getIntConfig(String key, int defaultValue) {
        return configRepository.findByConfigKey(key)
                .map(config -> Integer.parseInt(config.getConfigValue()))
                .orElse(defaultValue);
    }

    /**
     * ä¿å­˜é…ç½®
     */
    private void saveConfig(String key, String value) {
        SystemConfig config = configRepository.findByConfigKey(key)
                .orElse(new SystemConfig(key));

        config.setConfigValue(value);
        config.setConfigGroup("alert");
        config.setUpdatedAt(LocalDateTime.now());
        config.setUpdatedBy("admin");

        configRepository.save(config);
    }

    /**
     * æ¸…é™¤é…ç½®ç¼“å­˜
     */
    private void clearConfigCache() {
        var cache = cacheManager.getCache("system_config");
        if (cache != null) {
            cache.clear();
            log.info("[å‘Šè­¦è®¾ç½®æœåŠ¡] å·²æ¸…é™¤é…ç½®ç¼“å­˜ï¼Œé…ç½®å·²é‡æ–°åŠ è½½");
        }
    }
}
```

### 6.4 ä¿®æ”¹ DbDoctorProperties

#### 6.4.1 æ·»åŠ  @ConfigurationProperties åŠ¨æ€ç»‘å®š

```java
package com.dbdoctor.config;

import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.stereotype.Component;

/**
 * DB-Doctor é…ç½®å±æ€§
 * æ”¯æŒä»æ•°æ®åº“çƒ­æ›´æ–°
 */
@Component
@ConfigurationProperties(prefix = "db-doctor")
public class DbDoctorProperties {

    private NotifyProperties notify = new NotifyProperties();

    // Getter and Setter
    public NotifyProperties getNotify() {
        return notify;
    }

    public void setNotify(NotifyProperties notify) {
        this.notify = notify;
    }

    /**
     * é€šçŸ¥é…ç½®å±æ€§
     */
    public static class NotifyProperties {
        /**
         * ä¸¥é‡ç¨‹åº¦é˜ˆå€¼ï¼ˆä»æ•°æ®åº“è¯»å–ï¼Œæ”¯æŒçƒ­æ›´æ–°ï¼‰
         */
        private Double severityThreshold = 3.0;

        /**
         * å†·å´æœŸï¼ˆå°æ—¶ï¼‰ï¼ˆä»æ•°æ®åº“è¯»å–ï¼Œæ”¯æŒçƒ­æ›´æ–°ï¼‰
         */
        private Integer coolDownHours = 1;

        /**
         * æ€§èƒ½æ¶åŒ–å€ç‡ï¼ˆä»æ•°æ®åº“è¯»å–ï¼Œæ”¯æŒçƒ­æ›´æ–°ï¼‰
         */
        private Double degradationMultiplier = 1.5;

        // Getters and Setters
        public Double getSeverityThreshold() {
            return severityThreshold;
        }

        public void setSeverityThreshold(Double severityThreshold) {
            this.severityThreshold = severityThreshold;
        }

        public Integer getCoolDownHours() {
            return coolDownHours;
        }

        public void setCoolDownHours(Integer coolDownHours) {
            this.coolDownHours = coolDownHours;
        }

        public Double getDegradationMultiplier() {
            return degradationMultiplier;
        }

        public void setDegradationMultiplier(Double degradationMultiplier) {
            this.degradationMultiplier = degradationMultiplier;
        }
    }
}
```

### 6.5 å®ç°çƒ­æ›´æ–°ç›‘å¬å™¨

#### 6.5.1 AlertSettingsRefreshListener.java

```java
package com.dbdoctor.config;

import com.dbdoctor.entity.SystemConfig;
import com.dbdoctor.repository.SystemConfigRepository;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.context.event.ApplicationReadyEvent;
import org.springframework.context.event.EventListener;
import org.springframework.stereotype.Component;

/**
 * å‘Šè­¦è®¾ç½®çƒ­æ›´æ–°ç›‘å¬å™¨
 * åº”ç”¨å¯åŠ¨æ—¶ä»æ•°æ®åº“åŠ è½½é…ç½®
 */
@Slf4j
@Component
@RequiredArgsConstructor
public class AlertSettingsRefreshListener {

    private final SystemConfigRepository configRepository;
    private final DbDoctorProperties properties;

    /**
     * åº”ç”¨å¯åŠ¨æ—¶åŠ è½½å‘Šè­¦è®¾ç½®
     */
    @EventListener(ApplicationReadyEvent.class)
    public void loadAlertSettings() {
        log.info("[çƒ­æ›´æ–°ç›‘å¬å™¨] åŠ è½½å‘Šè­¦è®¾ç½®...");

        loadConfig("alert.severity-threshold", "3.0", value -> {
            properties.getNotify().setSeverityThreshold(Double.parseDouble(value));
            log.info("âœ“ ä¸¥é‡ç¨‹åº¦é˜ˆå€¼: {} ç§’", value);
        });

        loadConfig("alert.cool-down-hours", "1", value -> {
            properties.getNotify().setCoolDownHours(Integer.parseInt(value));
            log.info("âœ“ å†·å´æœŸ: {} å°æ—¶", value);
        });

        loadConfig("alert.degradation-multiplier", "1.5", value -> {
            properties.getNotify().setDegradationMultiplier(Double.parseDouble(value));
            log.info("âœ“ æ€§èƒ½æ¶åŒ–å€ç‡: {}", value);
        });

        log.info("[çƒ­æ›´æ–°ç›‘å¬å™¨] å‘Šè­¦è®¾ç½®åŠ è½½å®Œæˆ");
    }

    private void loadConfig(String key, String defaultValue, java.util.function.Consumer<String> setter) {
        String value = configRepository.findByConfigKey(key)
                .map(SystemConfig::getConfigValue)
                .orElse(defaultValue);
        setter.accept(value);
    }
}
```

---

## ä¸ƒã€å‰ç«¯å®ç°æ–¹æ¡ˆ

### 7.1 è·¯ç”±è°ƒæ•´

#### 7.1.1 router/index.ts

```typescript
// å‘Šè­¦ä¸é€šçŸ¥æ¨¡å—
{
  path: '/alert-notify',
  name: 'AlertNotify',
  redirect: '/alert-notify/history',
  component: () => import('@/views/AlertNotify/index.vue'),
  meta: { title: 'å‘Šè­¦ä¸é€šçŸ¥', icon: 'Bell', requiresAuth: false },
  children: [
    {
      path: 'history',
      name: 'AlertHistory',
      component: () => import('@/views/AlertNotify/History.vue'),
      meta: { title: 'å‘Šè­¦å†å²' }
    },
    {
      path: 'notification',
      name: 'NotificationSettings',
      component: () => import('@/views/AlertNotify/NotificationSettings.vue'),
      meta: { title: 'é€šçŸ¥è®¾ç½®' }
    }
  ]
}
```

### 7.2 é¡µé¢æ–‡ä»¶è°ƒæ•´

#### 7.2.1 åˆ é™¤çš„æ–‡ä»¶

- âŒ `views/Monitoring/AlertRuleConfig.vue`ï¼ˆåˆ é™¤ï¼‰
- âŒ `views/Monitoring/AlertManagement.vue`ï¼ˆåˆ é™¤ï¼‰

#### 7.2.2 æ–°å¢çš„æ–‡ä»¶

- âœ… `views/AlertNotify/index.vue`ï¼ˆå‘Šè­¦ä¸é€šçŸ¥é¦–é¡µï¼‰
- âœ… `views/AlertNotify/History.vue`ï¼ˆå‘Šè­¦å†å²é¡µé¢ï¼‰
- âœ… `views/AlertNotify/NotificationSettings.vue`ï¼ˆé€šçŸ¥è®¾ç½®é¡µé¢ï¼‰

#### 7.2.3 ä¿®æ”¹çš„æ–‡ä»¶

- ğŸ”„ `views/Settings/index.vue`ï¼ˆä¿®æ”¹"ç›‘æ§ä¸é€šçŸ¥"ä¸º"å‘Šè­¦ä¸é€šçŸ¥"ï¼Œç§»é™¤å‘Šè­¦è§„åˆ™é…ç½®ï¼‰
- ğŸ”„ `views/Settings/AlertSettings.vue`ï¼ˆæ–°å¢ï¼ŒåªåŒ…å«3ä¸ªå‚æ•°é…ç½®ï¼‰

### 7.3 API æ¥å£å°è£…

#### 7.3.1 api/alertSettings.tsï¼ˆæ–°å¢ï¼‰

```typescript
/**
 * å‘Šè­¦è®¾ç½® API
 */

import { request } from './index'

export const alertSettingsApi = {
  /**
   * æŸ¥è¯¢å‘Šè­¦è®¾ç½®
   */
  getSettings: () => {
    return request({
      url: '/alert-settings',
      method: 'get'
    })
  },

  /**
   * æ›´æ–°å‘Šè­¦è®¾ç½®
   */
  updateSettings: (data: {
    severityThreshold: number
    coolDownHours: number
    degradationMultiplier: number
  }) => {
    return request({
      url: '/alert-settings',
      method: 'post',
      data
    })
  },

  /**
   * é‡ç½®ä¸ºé»˜è®¤å€¼
   */
  resetSettings: () => {
    return request({
      url: '/alert-settings/reset',
      method: 'post'
    })
  }
}
```

### 7.4 ç»„ä»¶å®ç°

#### 7.4.1 AlertSettings.vueï¼ˆè®¾ç½®ä¸­å¿ƒï¼‰

```vue
<template>
  <div class="alert-settings">
    <el-form :model="form" label-width="180px">
      <!-- ä¸¥é‡ç¨‹åº¦é˜ˆå€¼ -->
      <el-form-item>
        <template #label>
          <span>ä¸¥é‡ç¨‹åº¦é˜ˆå€¼ï¼ˆç§’ï¼‰</span>
          <el-tooltip
            content="å¹³å‡æŸ¥è¯¢è€—æ—¶ä½äºæ­¤å€¼ä¸å‘é€é€šçŸ¥"
            placement="top"
          >
            <el-icon class="tooltip-icon"><QuestionFilled /></el-icon>
          </el-tooltip>
        </template>
        <el-input-number
          v-model="form.severityThreshold"
          :min="1.0"
          :max="10.0"
          :step="0.1"
          :precision="1"
          @change="handleUpdate"
        />
        <span class="range-hint">èŒƒå›´: 1.0 - 10.0</span>
      </el-form-item>

      <!-- å†·å´æœŸ -->
      <el-form-item>
        <template #label>
          <span>å†·å´æœŸï¼ˆå°æ—¶ï¼‰</span>
          <el-tooltip
            content="åŒä¸€ SQL ä¸¤æ¬¡é€šçŸ¥çš„æœ€å°é—´éš”æ—¶é—´"
            placement="top"
          >
            <el-icon class="tooltip-icon"><QuestionFilled /></el-icon>
          </el-tooltip>
        </template>
        <el-input-number
          v-model="form.coolDownHours"
          :min="1"
          :max="168"
          :step="1"
          @change="handleUpdate"
        />
        <span class="range-hint">èŒƒå›´: 1 - 168ï¼ˆ1å°æ—¶-1å‘¨ï¼‰</span>
      </el-form-item>

      <!-- æ€§èƒ½æ¶åŒ–å€ç‡ -->
      <el-form-item>
        <template #label>
          <span>æ€§èƒ½æ¶åŒ–å€ç‡</span>
          <el-tooltip
            content="å½“å‰è€—æ—¶/ä¸Šæ¬¡é€šçŸ¥è€—æ—¶ >= æ­¤å€¼æ—¶è§¦å‘äºŒæ¬¡å”¤é†’é€šçŸ¥"
            placement="top"
          >
            <el-icon class="tooltip-icon"><QuestionFilled /></el-icon>
          </el-tooltip>
        </template>
        <el-input-number
          v-model="form.degradationMultiplier"
          :min="1.1"
          :max="10.0"
          :step="0.1"
          :precision="1"
          @change="handleUpdate"
        />
        <span class="range-hint">èŒƒå›´: 1.1 - 10.0</span>
      </el-form-item>
    </el-form>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { QuestionFilled } from '@element-plus/icons-vue'
import { ElMessage } from 'element-plus'
import { alertSettingsApi } from '@/api/alertSettings'

const form = ref({
  severityThreshold: 3.0,
  coolDownHours: 1,
  degradationMultiplier: 1.5
})

// åŠ è½½é…ç½®
const loadSettings = async () => {
  try {
    const res = await alertSettingsApi.getSettings()
    if (res.code === 'SUCCESS') {
      form.value = res.data
    }
  } catch (error) {
    console.error('åŠ è½½å‘Šè­¦è®¾ç½®å¤±è´¥:', error)
  }
}

// æ›´æ–°é…ç½®
const handleUpdate = async () => {
  try {
    await alertSettingsApi.updateSettings(form.value)
    ElMessage.success('ä¿å­˜æˆåŠŸ')
  } catch (error: any) {
    ElMessage.error(error.message || 'ä¿å­˜å¤±è´¥')
  }
}

onMounted(() => {
  loadSettings()
})
</script>

<style scoped lang="scss">
.alert-settings {
  .tooltip-icon {
    margin-left: 4px;
    cursor: help;
    color: var(--el-text-color-secondary);
  }

  .range-hint {
    margin-left: 12px;
    font-size: 12px;
    color: var(--el-text-color-secondary);
  }
}
</style>
```

---

## å…«ã€å¼€å‘ä»»åŠ¡æ¸…å•

### 8.1 åç«¯ä»»åŠ¡

| åºå· | ä»»åŠ¡ | ä¼˜å…ˆçº§ | é¢„ä¼°æ—¶é—´ |
|------|------|--------|---------|
| 1 | åˆ›å»º `AlertSettingsDTO.java` | P0 | 0.5h |
| 2 | åˆ›å»º `AlertSettingsService.java` | P0 | 1.5h |
| 3 | åˆ›å»º `AlertSettingsController.java` | P0 | 1h |
| 4 | åˆ›å»º `AlertSettingsRefreshListener.java`ï¼ˆçƒ­æ›´æ–°ï¼‰ | P0 | 1h |
| 5 | ä¿®æ”¹ `DbDoctorProperties.java` | P0 | 0.5h |
| 6 | åˆ é™¤ `AlertRuleService.java`ï¼ˆæ— ç”¨æ–‡ä»¶ï¼‰ | P1 | 0.1h |
| 7 | åˆ é™¤ `AlertRuleController.java`ï¼ˆæ— ç”¨æ–‡ä»¶ï¼‰ | P1 | 0.1h |
| 8 | ç¼–å†™å•å…ƒæµ‹è¯• | P1 | 2h |

**åç«¯æ€»è®¡**: 8.7 å°æ—¶

### 8.2 å‰ç«¯ä»»åŠ¡

| åºå· | ä»»åŠ¡ | ä¼˜å…ˆçº§ | é¢„ä¼°æ—¶é—´ |
|------|------|--------|---------|
| 1 | åˆ›å»º `views/AlertNotify/index.vue` | P0 | 0.5h |
| 2 | åˆ›å»º `views/AlertNotify/History.vue` | P0 | 2h |
| 3 | åˆ›å»º `views/AlertNotify/NotificationSettings.vue` | P0 | 1h |
| 4 | åˆ›å»º `views/Settings/AlertSettings.vue` | P0 | 1.5h |
| 5 | ä¿®æ”¹ `views/Settings/index.vue` | P0 | 0.5h |
| 6 | åˆ›å»º `api/alertSettings.ts` | P0 | 0.5h |
| 7 | ä¿®æ”¹ `api/monitoring.ts`ï¼ˆåˆ é™¤ alertRuleApiï¼‰ | P1 | 0.1h |
| 8 | ä¿®æ”¹ `router/index.ts`ï¼ˆè·¯ç”±è°ƒæ•´ï¼‰ | P0 | 0.5h |
| 9 | ä¿®æ”¹å¯¼èˆªæ ï¼ˆèœå•é¡¹åç§°å’Œè·¯å¾„ï¼‰ | P0 | 0.5h |
| 10 | åˆ é™¤ `views/Monitoring/AlertRuleConfig.vue` | P1 | 0.1h |
| 11 | åˆ é™¤ `views/Monitoring/AlertManagement.vue` | P1 | 0.1h |

**å‰ç«¯æ€»è®¡**: 7.3 å°æ—¶

### 8.3 æµ‹è¯•ä»»åŠ¡

| åºå· | ä»»åŠ¡ | ä¼˜å…ˆçº§ | é¢„ä¼°æ—¶é—´ |
|------|------|--------|---------|
| 1 | åç«¯ API æµ‹è¯• | P0 | 1h |
| 2 | å‰ç«¯åŠŸèƒ½æµ‹è¯• | P0 | 1.5h |
| 3 | çƒ­æ›´æ–°æµ‹è¯• | P0 | 0.5h |
| 4 | é›†æˆæµ‹è¯• | P0 | 1h |

**æµ‹è¯•æ€»è®¡**: 4 å°æ—¶

### 8.4 æ–‡æ¡£ä»»åŠ¡

| åºå· | ä»»åŠ¡ | ä¼˜å…ˆçº§ | é¢„ä¼°æ—¶é—´ |
|------|------|--------|---------|
| 1 | æ›´æ–° README.md | P1 | 0.5h |
| 2 | æ›´æ–° API æ–‡æ¡£ | P1 | 0.5h |

**æ–‡æ¡£æ€»è®¡**: 1 å°æ—¶

---

## ä¹ã€æµ‹è¯•éªŒæ”¶æ ‡å‡†

### 9.1 åŠŸèƒ½æµ‹è¯•

#### 9.1.1 å‘Šè­¦è®¾ç½®é¡µé¢

- [ ] é¡µé¢èƒ½æ­£ç¡®åŠ è½½å¹¶æ˜¾ç¤ºå½“å‰é…ç½®å€¼
- [ ] ä¿®æ”¹"ä¸¥é‡ç¨‹åº¦é˜ˆå€¼"åç«‹å³ä¿å­˜ï¼Œå¹¶æ˜¾ç¤ºæˆåŠŸæç¤º
- [ ] ä¿®æ”¹"å†·å´æœŸ"åç«‹å³ä¿å­˜ï¼Œå¹¶æ˜¾ç¤ºæˆåŠŸæç¤º
- [ ] ä¿®æ”¹"æ€§èƒ½æ¶åŒ–å€ç‡"åç«‹å³ä¿å­˜ï¼Œå¹¶æ˜¾ç¤ºæˆåŠŸæç¤º
- [ ] è¾“å…¥è¶…å‡ºèŒƒå›´æ—¶æ˜¾ç¤ºé”™è¯¯æç¤º
- [ ] é¼ æ ‡æ‚¬åœåœ¨ `?` å›¾æ ‡ä¸Šèƒ½æ˜¾ç¤ºæ­£ç¡®çš„è¯´æ˜æ–‡å­—

#### 9.1.2 å‘Šè­¦å†å²é¡µé¢

- [ ] é¡µé¢èƒ½æ­£ç¡®åŠ è½½å‘Šè­¦å†å²æ•°æ®
- [ ] ç»Ÿè®¡å¡ç‰‡æ˜¾ç¤ºæ­£ç¡®çš„æ•°å­—
- [ ] ç­›é€‰å™¨èƒ½æ­£ç¡®è¿‡æ»¤æ•°æ®
- [ ] åˆ†é¡µåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] "æ ‡è®°è§£å†³"æŒ‰é’®èƒ½æ­£ç¡®æ›´æ–°å‘Šè­¦çŠ¶æ€
- [ ] "æŸ¥çœ‹è¯¦æƒ…"å¼¹çª—èƒ½æ­£ç¡®æ˜¾ç¤ºå‘Šè­¦è¯¦ç»†ä¿¡æ¯

#### 9.1.3 é€šçŸ¥è®¾ç½®é¡µé¢

- [ ] ä¿æŒç°æœ‰åŠŸèƒ½ä¸å˜
- [ ] èƒ½æ­£ç¡®é…ç½®é‚®ä»¶ã€é’‰é’‰ã€ä¼ä¸šå¾®ä¿¡ã€é£ä¹¦é€šçŸ¥

### 9.2 çƒ­æ›´æ–°æµ‹è¯•

- [ ] ä¿®æ”¹å‘Šè­¦è®¾ç½®åï¼Œåç«¯ `AnalysisService.shouldNotify()` ç«‹å³ä½¿ç”¨æ–°å€¼
- [ ] ä¸éœ€è¦é‡å¯åº”ç”¨
- [ ] é…ç½®æŒä¹…åŒ–åˆ°æ•°æ®åº“ï¼Œé‡å¯åä¿æŒæœ€æ–°å€¼

### 9.3 è¾¹ç•Œæµ‹è¯•

- [ ] ä¸¥é‡ç¨‹åº¦é˜ˆå€¼è¾“å…¥ 0.9 æ—¶æ‹’ç»ä¿å­˜ï¼ˆæœ€å°å€¼ 1.0ï¼‰
- [ ] ä¸¥é‡ç¨‹åº¦é˜ˆå€¼è¾“å…¥ 10.1 æ—¶æ‹’ç»ä¿å­˜ï¼ˆæœ€å¤§å€¼ 10.0ï¼‰
- [ ] å†·å´æœŸè¾“å…¥ 0 æ—¶æ‹’ç»ä¿å­˜ï¼ˆæœ€å°å€¼ 1ï¼‰
- [ ] å†·å´æœŸè¾“å…¥ 169 æ—¶æ‹’ç»ä¿å­˜ï¼ˆæœ€å¤§å€¼ 168ï¼‰
- [ ] æ€§èƒ½æ¶åŒ–å€ç‡è¾“å…¥ 1.0 æ—¶æ‹’ç»ä¿å­˜ï¼ˆæœ€å°å€¼ 1.1ï¼‰
- [ ] æ€§èƒ½æ¶åŒ–å€ç‡è¾“å…¥ 10.1 æ—¶æ‹’ç»ä¿å­˜ï¼ˆæœ€å¤§å€¼ 10.0ï¼‰

### 9.4 ç”¨æˆ·ä½“éªŒæµ‹è¯•

- [ ] æ‰€æœ‰æ“ä½œéƒ½æœ‰æ˜ç¡®çš„åé¦ˆï¼ˆæˆåŠŸ/å¤±è´¥æç¤ºï¼‰
- [ ] é¡µé¢åŠ è½½é€Ÿåº¦å¿«ï¼ˆ< 1ç§’ï¼‰
- [ ] ç•Œé¢å¸ƒå±€åˆç†ï¼Œæ— é”™ä½
- [ ] æš—è‰²ä¸»é¢˜é€‚é…æ­£å¸¸

### 9.5 å…¼å®¹æ€§æµ‹è¯•

- [ ] Chrome æµè§ˆå™¨æµ‹è¯•é€šè¿‡
- [ ] Firefox æµè§ˆå™¨æµ‹è¯•é€šè¿‡
- [ ] Edge æµè§ˆå™¨æµ‹è¯•é€šè¿‡

---

## åã€é™„å½•

### 10.1 æŠ€æœ¯æ ˆ

- **åç«¯**: Spring Boot 3.2.2 + Java 17
- **å‰ç«¯**: Vue 3 + Element Plus + TypeScript
- **æ•°æ®åº“**: H2ï¼ˆå†…éƒ¨æ•°æ®ï¼‰ + MySQLï¼ˆç›®æ ‡æ•°æ®åº“ï¼‰

### 10.2 å‚è€ƒèµ„æ–™

- DB-Doctor å…¨åŠŸèƒ½æŠ€æœ¯ç™½çš®ä¹¦ v3.0.0
- Spring Boot ConfigurationProperties æ–‡æ¡£
- Element Plus Form ç»„ä»¶æ–‡æ¡£

### 10.3 ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä½œè€… | è¯´æ˜ |
|------|------|------|------|
| v1.0 | 2026-02-07 | å¼€å‘å›¢é˜Ÿ | åˆå§‹ç‰ˆæœ¬ |

---

**æ–‡æ¡£ç»“æŸ**
